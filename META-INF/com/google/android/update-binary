#!/sbin/sh

OUTFD=$2
ZIP=$3

ui_print() {
  echo -n -e "ui_print $1\n" > /proc/self/fd/$OUTFD
  echo -n -e "ui_print\n" > /proc/self/fd/$OUTFD
}

ui_print "Auto generated flashable By ZyCromerZ"
ui_print " ";
ui_print " - gpu libs from: 11111"
ui_print " ";
ui_print " - file created at: 00000"
ui_print " ";
cd /tmp
rm -rf BegoGpuLib
mkdir BegoGpuLib
cd BegoGpuLib
unzip -o "$ZIP"
ls
ui_print " ";
ui_print " - mounting vendor partition"
ui_print " ";
mount /vendor
mount /data
if [ ! -d /vendor/etc ]; then
  ui_print " - Failed to mount vendor partition! -_-"
  exit 1
fi

if [ ! -d /data/zyc-backup-lib ];then
  ui_print " ";
  ui_print " - create bakcup folder for /vendor/lib/egl/"
  mkdir /data/zyc-backup-lib
fi
if [ ! -d /data/zyc-backup-lib64 ];then
  ui_print " ";
  ui_print " - create bakcup folder for /vendor/lib64/egl/"
  mkdir /data/zyc-backup-lib64
fi
cp -af /vendor/lib/egl/* /data/zyc-backup-lib
cp -af /vendor/lib64/egl/* /data/zyc-backup-lib64

rm -rf /vendor/lib/egl/*
ui_print " ";
ui_print " - cleanup files from /vendor/lib/egl/"
cp -af system/vendor/lib/egl/* /vendor/lib/egl
ui_print " ";
ui_print " - copy new libs to /vendor/lib/egl/"
rm -rf /vendor/lib64/egl/*
ui_print " ";
ui_print " - cleanup files from /vendor/lib64/egl/"
cp -af system/vendor/lib64/egl/* /vendor/lib64/egl
ui_print " ";
ui_print " - copy new libs to /vendor/lib64/egl/"

ui_print " ";
ui_print " - done . . . . ."

ui_print " ";
ui_print " - unmounting vendor partition"
unmount /vendor
unmount /data
ui_print " ";
ui_print " - enjoy ur new libs :v"
ui_print " ";
rm -rf /tmp/BegoGpuLib
sync
